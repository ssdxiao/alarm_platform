<html>
<head>
    <title>监控告警后台管理系统</title>
    <link href="/static/css/bootstrap-combined.min.css" rel="stylesheet">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/api.js"></script>
    <script src="/static/js/custumer.js"></script>
    <script src="/static/js/alarm.js"></script>
    <script src="/static/js/manage.js"></script>

    <script type="text/javascript">

        function load() {
            console.log("load");
            var value = getCookie("user");
            if (value) {
                var data = JSON.parse(value);
                console.log(data.user + " is login" + " " + data.token);
                if (data.user) {
                    $('#login_index').attr('style', 'display:none');
                    $("#manage_index").text("欢迎 " + data.user);
                    $("#title").attr("style", "display:''")

                    if (data.user == "admin")
                    {
                        $("#manage_list").attr("style", "display:''")
                    }
                    get_alarm_list_refresh(1)

                }
            }
            else {
                console.log("no user login")
                $('#login_index').trigger("click")

            }
        }

        $(function () {
            $('#login_example').click(function (e) {
                $("#message_modal_login").text("");
                login($("#inputUser").val(),
                        $("#inputPassword").val(),
                        function (data) {
                            var result = JSON.parse(data);
                            console.log(result);
                            if (result.result == "error") {
                                $("#message_modal_login").text("用户名或者密码错误！")
                            }
                            else {
                                $('#modal_login').modal('hide');
                                //登陆成功以后 开始获取相关参数并刷新界面
                                /*
                                $('#login_index').attr('style', 'display:none');
                                $("#manage_index").text("欢迎 " + result.user);
                                $("#title").attr("style", "display:''");
                                */
                                delCookie("user");
                                setCookie("user", data);
                                location.reload()



                            }
                        });
                // Don't let the link do its natural thing
                e.preventDefault()
            });
            $('#logout_index').click(function () {
                var value = getCookie("user");
                if (value) {
                    var data = JSON.parse(value);
                    logout(data.user, data.token)
                }
                delCookie("user");
                location.reload()


            })


//-----------------------custumer function -------------------------------//
            $('#add_custumer_modal').click(function (e) {
                add_custumer($("#inputCustumerName").val(),
                        $("#inputCustumerTelephone").val(),
                        $("#inputCustumerEmail").val(),
                        $("#inputCustumerRemark").val(),
                        function (data) {
                            var result = JSON.parse(data);
                            console.log(result);
                            if (result.result == "error") {
                                $("#message_modal_custumer").text("增加用户失败")
                            }
                            else {
                                $('#modal_add_custumer').modal('hide');
                                //重新刷新用户列表
                                var index = window.current_page
                                get_custumer_list_refresh(index);

                            }
                        });
                // Don't let the link do its natural thing
                e.preventDefault()
            });

            $("#custumer_add_other").click(function (e) {
                var data = {}
                data.name = "";
                data.token = "";
                data.famliyphone = "";
                data.workphone = "";
                data.telphone = "";
                insert_to_custumer_detail_table(data)

            });


            $("#update_custumer_modal").click(function (e) {
                var data = {}
                data.CustumerId = $("#inputCustumerIdDetail").val();
                data.CustumerName = $("#inputCustumerNameDetail").val();
                data.CustumerTelephone = $("#inputCustumerTelephoneDetail").val();
                data.CustumerEmail = $("#inputCustumerEmailDetail").val();
                data.CustumerRemark = $("#inputCustumerRemarkDetail").val();
                data.other = new Array()
                //获取other元素
                $("#custumer_table_detail tbody tr").each(function () {
                    var other = {}
                    $(this).find("td input").each(function () {
                        if ($(this).attr("name") == "name") {
                            other.name = $(this).val();
                        }
                        else if ($(this).attr("name") == "token") {
                            other.token = $(this).val();
                        }
                        else if ($(this).attr("name") == "famliyphone") {
                            other.famliyphone = $(this).val();
                        }
                        else if ($(this).attr("name") == "workphone") {
                            other.workphone = $(this).val();
                        }
                        else if ($(this).attr("name") == "telphone") {
                            other.telphone = $(this).val();
                        }

                    });
                    if (other.name) {
                        data.other.push(other)
                    }
                })

                console.log(data)
                //发送信息
                update_custumer(data, function (data) {
                    var result = JSON.parse(data);
                    console.log(result);
                    if (result.result == "error") {
                        console.log("更新用户失败")
                    }
                    else {
                        $("#modal_custumer_detail").modal('hide')
                        var index = window.current_page
                        get_custumer_list_refresh(index);
                    }

                })


            });


            $('#custumer_list').click(function (e) {
                get_custumer_list_refresh(1)
            });
//-----------------------------告警-------------------------//


            $('#alarm_list').click(function (e) {
                get_alarm_list_refresh(1)
            })


//----------------------------管理员------------------------//


              $('#add_manage_modal').click(function (e) {
                add_manage($("#inputManageName").val(),
                        $("#inputManageTelephone").val(),
                        $("#inputManagePassword").val(),

                        function (data) {
                            var result = JSON.parse(data);
                            console.log(result);
                            if (result.result == "error") {
                                $("#message_modal_manage").text("增加管理员失败")
                            }
                            else {
                                $('#modal_add_manage').modal('hide');
                                //重新刷新用户列表
                                var index = window.current_page
                                get_manage_list_refresh(index);

                            }
                        });
                // Don't let the link do its natural thing
                e.preventDefault()
            });

            $('#manage_list').click(function (e) {
                get_manage_list_refresh(1)
            });

             $("#update_manage_modal").click(function (e) {
                var data = {}
                data.ManageId = $("#inputManageIdDetail").val();
                data.ManageName = $("#inputManageNameDetail").val();
                data.ManageTelephone = $("#inputManageTelephoneDetail").val();

                console.log(data)
                //发送信息
                update_manage(data, function (data) {
                    var result = JSON.parse(data);
                    console.log(result);
                    if (result.result == "error") {
                        console.log("更新管理员失败")
                    }
                    else {
                        $("#modal_manage_detail").modal('hide')
                        var index = window.current_page;
                        get_manage_list_refresh(index);
                    }

                })


            });

            $("#update_change_modal").click(function (e) {
                var data = {}
                data.ManageId = $("#inputManageIdDetail").val();
                data.ManagePassword = $("#inputManagePasswdDetail").val();

                console.log(data)
                //发送信息
                update_manage_passwd(data, function (data) {
                    var result = JSON.parse(data);
                    console.log(result);
                    if (result.result == "error") {
                        console.log("更新管理员密码失败")
                    }
                    else {
                        $("#modal_change_passwd").modal('hide')
                        var index = window.current_page;
                        get_manage_list_refresh(index);
                    }

                })


            });



            //-------------------------------------//
            //-----------------------------------------//

        });
    </script>
</head>
<body onload="load()">
<div class="container">
    <div class="row">
        <div class="span2">
        </div>
        <div class="span8">
            <h3>
                监控告警后台管理系统
            </h3>

            <div id="modal_login" class="modal hide fade in" style="display: none; ">
                <div class="modal-header">
                    <a class="close" data-dismiss="modal">×</a>
                    <h3>请登录</h3>
                </div>


                <div class="controls" align="center"><input id="inputUser" placeholder="用户名" type="text"/></div>

                <div class="controls" align="center"><input id="inputPassword" placeholder="密码" type="password"/></div>
                <div id="message_modal_login"></div>

                <div class="modal-footer">
                    <a href="#" class="btn btn-success" id="login_example">登陆</a>
                    <a href="#" class="btn" data-dismiss="modal">关闭</a>
                </div>
            </div>
            <p><a data-toggle="modal" href="#modal_login" class="btn btn-primary" id="login_index">登陆</a></p>
            <div class="control-list" id="title"   style="display:none">
               <a data-toggle="modal" href="#modal_user_update" class="btn" class ="btn" id="manage_index"></a>
                <a class="btn btn-primary" id="logout_index">登出</a>
                </div>
            <hr>
            <div class="tabbable" id="tabs-619833">
                <ul class="nav nav-tabs">
                    <li class="active">
                        <a data-toggle="tab" href="#panel-alarm" id="alarm_list">告警列表</a>
                    </li>
                    <li>
                        <a data-toggle="tab" href="#panel-custumer" id="custumer_list">客户列表</a>
                    </li>
                    <li>
                        <a data-toggle="tab" href="#panel-log" id="log_list">日志列表</a>
                    </li>
                    <li>
                        <a data-toggle="tab" href="#panel-manage" id="manage_list" style="display:none">管理员列表</a>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane active" id="panel-alarm">
                        <div id="modal_alarm_detail" class="modal hide fade in" style=" display: none; ">
                            <div class="modal-header">
                                <a class="close" data-dismiss="modal">×</a>
                                <h3>告警详情</h3>
                            </div>
                            <h3 id="deal_progress"></h3>
                            <div class="modal-body">
                                <table class="table table-hover table-condensed" id="modal_alarm_table">
                            <thead>
                            <tr>
                                <th>
                                    告警编号
                                </th>
                                <th>
                                    告警级别
                                </th>
                                <th>
                                    告警时间
                                </th>
                                <th>
                                    告警对象
                                </th>
                                <th>
                                    告警内容
                                </th>
                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>


                               <div class="span">
                                <div class="span2"><span>火警: </span><a href="#" class="btn" >911</a></div>
                                <div class="span2"><span>急救: </span><a href="#" class="btn" >120</a></div>
                                <div class="span2"><span>漏水: </span><a href="#" class="btn" >111</a></div>
                                <div class="span2"><span>漏气: </span><a href="#" class="btn" >112</a></div>
                                <div class="span4"><span>主人: </span><a href="#" class="btn" id="custumer_telephone" ></a></div>
                               </div>



                                <table class="table table-hover table-condensed table-layout:fixed"
                                       id="alarm_table_other">
                                    <thead>
                                    <tr>
                                        <th width="18%">
                                            姓名
                                        </th>
                                        <th width="18%">
                                            口令
                                        </th>
                                        <th width="18%">
                                            家庭电话
                                        </th>
                                        <th width="18%">
                                            工作电话
                                        </th>
                                        <th width="18%">
                                            手机
                                        </th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>


                            <div class="modal-footer">
                                <a href="#" class="btn btn-success" id="deal_alarm_ok">处理完成</a>
                                <a href="#" class="btn" data-dismiss="modal">暂时关闭</a>
                            </div>
                        </div>
                        <p><a data-toggle="modal" href="#modal_alarm_detail" class="btn btn-primary"
                              id="alarm_detail" style="display: none"></a>
                        </p>

                        <table class="table table-hover table-condensed" id="alarm_table">
                            <thead>
                            <tr>
                                <th>
                                    告警编号
                                </th>
                                <th>
                                    告警级别
                                </th>
                                <th>
                                    告警时间
                                </th>
                                <th>
                                    告警对象
                                </th>
                                <th>
                                    告警内容
                                </th>
                                <th>
                                    相关用户
                                </th>
                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>

                        <div id="alarm_page" class="pagination" styple="display : none" >
                            <ul>

                            </ul>
                        </div>
                        .

                    </div>

                    <div class="tab-pane" id="panel-custumer">

                        <!-- 新增用户详细信息的modal-->
                        <div id="modal_custumer_detail" class="modal hide fade in" style=" display: none; ">
                            <div class="modal-header">
                                <a class="close" data-dismiss="modal">×</a>
                                <h3>客户详情</h3>
                            </div>
                            <div class="modal-body">
                                <label for="inputCustumerIdDetail">客户id</label>
                                <input id="inputCustumerIdDetail" type="text" disabled>
                                <label for="inputCustumerNameDetail">客户姓名</label>
                                <input id="inputCustumerNameDetail" placeholder="客户姓名"
                                       type="text">
                                <label for="inputCustumerTelephoneDetail">客户电话</label>
                                <input id="inputCustumerTelephoneDetail"
                                       placeholder="客户电话"
                                       type="text">
                                <label for="inputCustumerEmailDetail">客户邮箱</label>
                                <input id="inputCustumerEmailDetail" placeholder="客户邮箱"
                                       type="text">
                                <label for="inputCustumerRemarkDetail">备注</label>
                        <textarea id="inputCustumerRemarkDetail" placeholder="备注"
                        ></textarea>

                                <div id="message_modal_custumer_detail"></div>
                                <table class="table table-hover table-condensed table-layout:fixed"
                                       id="custumer_table_detail">
                                    <thead>
                                    <tr>
                                        <th width="18%">
                                            姓名
                                        </th>
                                        <th width="18%">
                                            口令
                                        </th>
                                        <th width="18%">
                                            家庭电话
                                        </th>
                                        <th width="18%">
                                            工作电话
                                        </th>
                                        <th width="18%">
                                            手机
                                        </th>
                                        <th width="10%">

                                        </th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                                <a href="#" class="btn btn-success" id="custumer_add_other">增加</a>
                            </div>

                            <div class="modal-footer">
                                <a href="#" class="btn btn-success" id="update_custumer_modal">修改</a>
                                <a href="#" class="btn" data-dismiss="modal">关闭</a>
                            </div>
                        </div>
                        <p><a data-toggle="modal" href="#modal_custumer_detail" class="btn btn-primary"
                              id="custumer_detail" style="display: none"></a>
                        </p>

                        <!-- 新增用户的modal-->
                        <div id="modal_add_custumer" class="modal" style="display: none; ">
                            <div class="modal-header">
                                <a class="close" data-dismiss="modal">×</a>
                                <h3>新增客户</h3>
                            </div>

                            <div class="modal-body">
                                <label for="inputCustumerName">客户姓名</label>
                                <input id="inputCustumerName" placeholder="客户姓名" class="form-control"
                                       type="text">
                                <label for="inputCustumerTelephone">客户电话</label>
                                <input id="inputCustumerTelephone"
                                       placeholder="客户电话"
                                       type="text">
                                <label for="inputCustumerEmail">客户邮箱</label>
                                <input id="inputCustumerEmail" placeholder="客户邮箱"
                                       type="text">
                                <label for="inputCustumerRemark">备注</label>
                        <textarea id="inputCustumerRemark" placeholder="备注"
                        ></textarea>
                                <div id="message_modal_custumer"></div>

                            </div>
                            <div class="modal-footer">
                                <a href="#" class="btn btn-success" id="add_custumer_modal">增加</a>
                                <a href="#" class="btn" data-dismiss="modal">关闭</a>
                            </div>
                        </div>
                        <p><a data-toggle="modal" href="#modal_add_custumer" class="btn btn-primary"
                              id="add_custumer">新增客户</a>
                        </p>
                        <table class="table table-hover table-condensed table-layout:fixed" id="custumer_table">
                            <thead>
                            <tr>
                                <th width="20%">
                                    客户id
                                </th>
                                <th width="20%">
                                    客户姓名
                                </th>
                                <th width="20%">
                                    客户电话
                                </th>
                                <th>
                                    备注
                                </th>
                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>


                        <div id="custumer_page" class="pagination" style="display:none">
                            <ul>
                            </ul>
                        </div>
                    </div>

                    <div class="tab-pane" id="panel-manage">

                        <!-- 新增管理员详细信息的modal-->
                        <div id="modal_change_passwd" class="modal hide fade in" style=" display: none; ">
                            <div class="modal-header">
                                <a class="close" data-dismiss="modal">×</a>
                                <h3>管理员详情</h3>
                            </div>
                            <div class="modal-body">
                                <label for="inputManagePasswdDetail">管理员密码</label>
                                <input id="inputManagePasswdDetail" type="text" >

                                </div>

                            <div class="modal-footer">
                                <a href="#" class="btn btn-success" id="update_change_modal">修改</a>
                                <a href="#" class="btn" data-dismiss="modal">关闭</a>
                            </div>
                        </div>
                        <div id="modal_manage_detail" class="modal hide fade in" style=" display: none; ">
                            <div class="modal-header">
                                <a class="close" data-dismiss="modal">×</a>
                                <h3>管理员详情</h3>
                            </div>
                            <div class="modal-body">
                                <label for="inputManageIdDetail">管理员id</label>
                                <input id="inputManageIdDetail" type="text" disabled>
                                <label for="inputManageNameDetail">管理员姓名</label>
                                <input id="inputManageNameDetail" placeholder="管理员姓名"
                                       type="text">
                                <label for="inputManageTelephoneDetail">管理员电话</label>
                                <input id="inputManageTelephoneDetail"
                                       placeholder="管理员电话"
                                       type="text">
                                <br>
                                <p><a data-toggle="modal" href="#modal_change_passwd" class="btn btn-success"
                              id="change_passwd" data-dismiss="modal">修改密码</a></p>
                                </div>


                            <div class="modal-footer">
                                <a href="#" class="btn btn-success" id="update_manage_modal">修改</a>
                                <a href="#" class="btn" data-dismiss="modal">关闭</a>
                            </div>
                        </div>
                        <p><a data-toggle="modal" href="#modal_manage_detail" class="btn btn-primary"
                              id="manage_detail" style="display: none"></a>
                        </p>

                        <!-- 新增管理员的modal-->
                        <div id="modal_add_manage" class="modal" style="display: none; ">
                            <div class="modal-header">
                                <a class="close" data-dismiss="modal">×</a>
                                <h3>新增管理员</h3>
                            </div>

                            <div class="modal-body">
                                <label for="inputManageName">管理员姓名</label>
                                <input id="inputManageName" placeholder="管理员姓名" class="form-control"
                                       type="text">
                                <label for="inputManageTelephone">管理员电话</label>
                                <input id="inputManageTelephone"
                                       placeholder="管理员电话"
                                       type="text">
                                <label for="inputManagePassword">管理员密码</label>
                                <input id="inputManagePassword" placeholder="管理员密码"
                                       type="text">

                                <div id="message_modal_manage"></div>

                            </div>
                            <div class="modal-footer">
                                <a href="#" class="btn btn-success" id="add_manage_modal">增加</a>
                                <a href="#" class="btn" data-dismiss="modal">关闭</a>
                            </div>
                        </div>
                        <p><a data-toggle="modal" href="#modal_add_manage" class="btn btn-primary"
                              id="add_manage">新增管理员</a>
                        </p>
                        <table class="table table-hover table-condensed table-layout:fixed" id="manage_table">
                            <thead>
                            <tr>
                                <th width="20%">
                                    管理员id
                                </th>
                                <th width="20%">
                                    管理员姓名
                                </th>
                                <th width="20%">
                                    管理员电话
                                </th>
                                <th>
                                    最后登录时间
                                </th>

                                <th>
                                    最后登出时间
                                </th>

                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>


                        <div id="manage_page" class="pagination" style="display:none">
                            <ul>
                            </ul>
                        </div>
                    </div>



                </div>
            </div>

        </div>
        <div class="span2">
        </div>
    </div>
</div>


</body>


</html>

