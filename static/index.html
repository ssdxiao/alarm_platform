<html>
<head>
    <title>监控告警后台管理系统</title>
    <link href="/static/css/bootstrap-combined.min.css" rel="stylesheet">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/api.js"></script>

<script type="text/javascript">

    function load() {
        console.log("load");
        var value = getCookie("user");
        if (value) {
            var data = JSON.parse(value);
            console.log(data.user + " is login" + " " + data.token);
            if (data.user) {
                $('#login_index').attr('style', 'display:none');
                $("#message_index").text("欢迎 " + data.user);
                $("#title").attr("style", "display:''")
            }
        }
        else {
            console.log("no user login")

        }
    }

    $(function () {
        $('#login_example').click(function (e) {
            $("#message_modal_login").text("");
            login($("#inputUser").val(),
                    $("#inputPassword").val(),
                    function (data) {
                        var result = JSON.parse(data);
                        console.log(result);
                        if (result.result == "error") {
                            $("#message_modal_login").text("用户名或者密码错误！")
                        }
                        else {
                            $('#modal_login').modal('hide');
                            //登陆成功以后 开始获取相关参数并刷新界面
                            $('#login_index').attr('style', 'display:none');
                            $("#message_index").text("欢迎 " + result.user);
                            $("#title").attr("style", "display:''");
                            delCookie("user");
                            setCookie("user", data);

                            //显示告警列表

                        }
                    });
            // Don't let the link do its natural thing
            e.preventDefault()
        });

        function test(a){
            console.log(a)
        }

        function get_custumer_list_refresh(index) {



            get_custumer_list( index,function (data) {
                var result = JSON.parse(data);
                console.log(result);
                if (result.result == "error") {
                    console.log("获取用户列表失败")
                }
                else {
                    //显示表信息
                    $("#custumer_table tbody" ).empty()
                    for(var i=0; i<result.data.length; i++) {
                        $("#custumer_table tbody").append("<tr class='default'> <td>"+result.data[i].custumerid+"</td> <td>"+result.data[i].custumername+"</td> <td>"+result.data[i].custumertelephone+"</td> <td colspan='4'>"+result.data[i].custumerremark+"</td> </tr>")
                    }
                   //显示分页条
                    window.current_custumer_page = result.curruntindex;
                    $("#custumer_page ul").empty()
                    $("#custumer_page ul").append("<li> <a >上一页</a> </li>");
                    var start_index = 0
                    var end_index =0
                    if (result.curruntindex >3)
                    {
                        var start_index = result.curruntindex -3

                    }
                    var diff = result.maxindex - result.curruntindex
                    if (diff >3)
                    {
                        end_index = result.curruntindex+3
                        if (result.curruntindex < 3 )
                        {
                            end_index = end_index + 3 - result.curruntindex
                        }
                        if (end_index > result.maxindex)
                        {
                            end_index = result.maxindex;
                        }
                    }
                    else{
                        end_index = result.maxindex;

                        start_index = start_index - 3 + diff;
                        if(start_index < 0)
                        {
                            start_index = 0

                        }

                    }

                    for(var i=start_index; i < end_index; i++) {
                        $("#custumer_page ul").append("<li> <a >" + (i + 1) + "</a> </li>");
                    }
                    $("#custumer_page ul").append("<li> <a >下一页</a> </li>");

                    console.log("current page" + window.current_custumer_page);
                    $("#custumer_page").attr("style", "display:''");
                    $('#custumer_page ul a').each(function() {
                        $(this).click(function(e){
                            var index
                            if ($(this).text() == "上一页")
                            {
                                index = window.current_custumer_page - 1;
                            }
                            else if($(this).text() == "下一页"){
                                index = window.current_custumer_page + 1;
                            }
                            else
                            {
                                index = $(this).text();
                            }
                           get_custumer_list_refresh(index)
                        })
                    })
                    }


            })

        }
        $('#user_list').click(function(e){
            get_custumer_list_refresh(1)
        })
        $('#add_custumer_modal').click(function (e) {
            add_custumer($("#inputCustumerName").val(),
                    $("#inputCustumerTelephone").val(),
                    $("#inputCustumerEmail").val(),
                    $("#inputCustumerRemark").val(),
                    function (data) {
                        var result = JSON.parse(data);
                        console.log(result);
                        if (result.result == "error") {
                            $("#message_modal_custumer").text("增加用户失败")
                        }
                        else {
                            $('#modal_add_custumer').modal('hide');
                            //重新刷新用户列表
                            get_custumer_list_refresh(1);

                        }
                    });
            // Don't let the link do its natural thing
            e.preventDefault()
        });

        $('#logout_index').click(function () {
            var value = getCookie("user");
            if (value) {
                var data = JSON.parse(value);
                logout(data.user, data.token)
            }
            delCookie("user");
            location.reload()


        })

    })


</script>
</head>
<body onload="load()">
<div class="container">
    <div class="row">
        <div class="span2">
        </div>
        <div class="span8">
            <h3>
                监控告警后台管理系统
            </h3>

            <div id="modal_login" class="modal hide fade in" style="display: none; ">
                <div class="modal-header">
                    <a class="close" data-dismiss="modal">×</a>
                    <h3>请登录</h3>
                </div>


                <div class="controls" align="center"><input id="inputUser" placeholder="用户名" type="text"/></div>

                <div class="controls" align="center"><input id="inputPassword" placeholder="密码" type="password"/></div>
                <div id="message_modal_login"></div>

                <div class="modal-footer">
                    <a href="#" class="btn btn-success" id="login_example">登陆</a>
                    <a href="#" class="btn" data-dismiss="modal">关闭</a>
                </div>
            </div>
            <p><a data-toggle="modal" href="#modal_login" class="btn btn-primary" id="login_index">登陆</a></p>
            <div class="control-list" id="title" style="display:none">
                <div class="span2" id="message_index"></div>
                <a class="btn btn-primary" id="logout_index">登出</a></div>

            <div class="tabbable" id="tabs-619833">
                <ul class="nav nav-tabs">
                    <li class="active">
                        <a data-toggle="tab" href="#panel-878780" id="alarm_list">告警列表</a>
                    </li>
                    <li>
                        <a data-toggle="tab" href="#panel-620525" id="user_list">用户列表</a>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane active" id="panel-878780">

                        <table class="table table-hover table-condensed">
                            <thead>
                            <tr>
                                <th>
                                    告警编号
                                </th>
                                <th>
                                    告警级别
                                </th>
                                <th>
                                    告警时间
                                </th>
                                <th>
                                    告警内容
                                </th>
                                <th>
                                    相关用户
                                </th>
                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>

                        <div class="pagination" style="display: none">
                            <ul>
                                <li>
                                    <a href="#">上一页</a>
                                </li>
                                <li>
                                    <a href="#">1</a>
                                </li>
                                <li>
                                    <a href="#">2</a>
                                </li>
                                <li>
                                    <a href="#">3</a>
                                </li>
                                <li>
                                    <a href="#">4</a>
                                </li>
                                <li>
                                    <a href="#">5</a>
                                </li>
                                <li>
                                    <a href="#">下一页</a>
                                </li>
                            </ul>
                        </div>
                        .

                    </div>

                    <div class="tab-pane" id="panel-620525">

                        <div id="modal_add_custumer" class="modal hide fade in" style="display: none; ">
                            <div class="modal-header">
                                <a class="close" data-dismiss="modal">×</a>
                                <h3>新增客户</h3>
                            </div>


                            <div class="controls" align="center"><input id="inputCustumerName" placeholder="客户姓名"
                                                                        type="text"></div>
                            <div class="controls" align="center"><input id="inputCustumerTelephone" placeholder="客户电话"
                                                                        type="text"></div>
                            <div class="controls" align="center"><input id="inputCustumerEmail" placeholder="客户邮箱"
                                                                        type="text"></div>
                            <div class="controls" align="center"><input id="inputCustumerRemark" placeholder="备注"
                                                                        type="text"></div>
                            <div id="message_modal_custumer"></div>

                            <div class="modal-footer">
                                <a href="#" class="btn btn-success" id="add_custumer_modal">增加</a>
                                <a href="#" class="btn" data-dismiss="modal">关闭</a>
                            </div>
                        </div>
                        <p><a data-toggle="modal" href="#modal_add_custumer" class="btn btn-primary" id="add_custumer">新增客户</a>
                        </p>
                        <table class="table table-hover table-condensed" id="custumer_table">
                            <thead>
                            <tr>
                                <th>
                                    客户id
                                </th>
                                <th>
                                    客户姓名
                                </th>
                                <th>
                                    客户电话
                                </th>
                                <th>
                                    备注
                                </th>
                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>


                        <div id ="custumer_page"class="pagination" style="display:none">
                            <ul>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <div class="span2">
        </div>
    </div>
</div>



</body>


</html>

